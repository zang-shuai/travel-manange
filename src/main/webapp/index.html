<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/cookie.js"></script>
    <script src="js/date.js"></script>

</head>
<body>
<div id="head">
</div>
<a id="namelink"><h1 id="name"></h1></a>

<a href="usserregister.html">用户注册</a>
<a id="register" href="userlogin.html">用户登录</a>
<a id="guider" href="guiderlogin.html">导游登录</a>
<a href="adminlogin.html">进入管理</a>
<button id="noregister" onclick="clearCookie('user');clearCookie('uid')">用户登出</button>
<div id="plans"></div>


<script>

    const pathname = window.document.location.pathname;
    const pa = pathname.substring(0, pathname.substr(1).indexOf('/') + 1);

    let date = new Date().format("yyyy-MM-dd");

    if (getCookie("user") === null) {
        document.getElementById("register").style.display = "inline";
        document.getElementById("noregister").style.display = "none";
    } else {
        document.getElementById("namelink").href = "userdetails.html" + "?uid=" + getCookie("uid");
        document.getElementById("register").style.display = "none";
        document.getElementById("noregister").style.display = "inline";
        //登录显示：
        document.getElementById("name").innerText = getCookie("user");
        fun1();
    }

    function fun1() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "getHeadServlet", true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                //获取服务器的响应结果
                let responseText = xmlhttp.responseText;
                let obj = JSON.parse(responseText); //由JSON字符串转换为JSON对象
                console.log(obj)
                let uhead = obj.uhead;
                document.getElementById("head").innerHTML = "<img height='50px' width='50px' src=" + uhead + ">"
            }
        }
    }

    getAllPlans()


    function getAllPlans() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "findAllPlanServlet", true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                //获取服务器的响应结果
                let responseText = xmlhttp.responseText;
                let arr = JSON.parse(responseText); //由JSON字符串转换为JSON对象
                console.log(arr)
                for (let obj in arr) {
                    let look = []
                    let tr = document.createElement("div")
                    let arrElement = arr[obj]
                    let pstartDate = new Date(arrElement["pstartDate"]).format("yyyy-MM-dd")
                    let pendDate = new Date(arrElement["pendDate"]).format("yyyy-MM-dd")
                    if (date < pstartDate) {
                    } else {
                        continue
                    }
                    look.push(arrElement["tname"])
                    look.push(arrElement["gname"])
                    look.push(pstartDate)
                    look.push(pendDate)
                    look.push(arrElement["pprice"])
                    for (let x in look) {
                        let td = document.createElement("div")
                        td.innerHTML = look[x]
                        tr.appendChild(td)
                    }

                    let a = document.createElement("a");
                    a.href = pa + "/purchase.html" + "?" + "pid=" + arrElement["pid"]
                    a.innerHTML = "查看详情"
                    let img = document.createElement("img");
                    img.src = arrElement["tourist"]["touristImg"][0]["taddress"]
                    // img.width="100%"
                    // img.height="100%"
                    // img.style="float:left"
                    document.getElementById("plans").appendChild(img);
                    // tr.style="float:none"
                    document.getElementById("plans").appendChild(tr);
                    document.getElementById("plans").appendChild(a);
                    document.getElementById("plans").appendChild(document.createElement("hr"));
                }
            }
        }
    }


</script>

</body>
</html>