<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
<div id="head">
</div>
<h1 id="name"></h1>
<a href="userregister.html">用户注册</a>
<a id="register" href="userlogin.html">用户登录</a>
<a id="guider" href="guiderlogin.html">导游登录</a>
<a href="admin.html">进入管理</a>
<button id="noregister" onclick="clearCookie('user')">用户登出</button>


<div id="tianan"></div>


<script>
    fun2()
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + "; " + expires;
    }

    function getCookie(cookieName) {
        var strCookie = document.cookie;
        var arrCookie = strCookie.split("; ");
        for (var i = 0; i < arrCookie.length; i++) {
            var arr = arrCookie[i].split("=");
            if (cookieName === arr[0]) {
                return arr[1];
            }
        }
        return null;
    }

    function clearCookie(name) {
        setCookie(name, "", -1);
        alert("你正要登出")
        location.reload();
    }

    if (getCookie("user") === null) {
        document.getElementById("register").style.display = "inline";
        document.getElementById("noregister").style.display = "none";
    } else {
        document.getElementById("register").style.display = "none";
        document.getElementById("noregister").style.display = "inline";
        //登录显示：
        document.getElementById("name").innerText = getCookie("user");
        fun1();
    }

    function fun1() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "getHeadServlet", true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                //获取服务器的响应结果
                let responseText = xmlhttp.responseText;
                let obj = JSON.parse(responseText); //由JSON字符串转换为JSON对象
                let uhead = obj.uhead;
                document.getElementById("head").innerHTML = "<img height='50px' width='50px' src=" + uhead + ">"
            }
        }
    }
    function fun2() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "findAllUserServlet", true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                //获取服务器的响应结果
                let responseText = xmlhttp.responseText;
                let obj = JSON.parse(responseText); //由JSON字符串转换为JSON对象
                document.getElementById("tianan").innerHTML = "<img height='50px' width='50px' src=" + uhead + ">"
            }
        }
    }
</script>

</body>
</html>